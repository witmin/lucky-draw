<!doctype html>
<html><head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="http://cdn.sockjs.org/sockjs-0.3.min.js"></script>
</head>
<body lang="en">

<div id="poor-man"></div>
<button id="rand">Random</button>
<div id="candidate">
    <form><input name="candidate" type="text"/></form>
    <ul></ul>
</div>

<script>
    var sockjs_url = '/sock';
    var sockjs = new SockJS(sockjs_url);

    sockjs.onopen    = function()  {

    };

    sockjs.onmessage = function(e) {
        var obj = JSON.parse(e.data);

        if (obj.candidates) {
            var candidates = obj.candidates;
            var $candidateList = $('#candidate ul');
            $candidateList.empty();
            $.each(candidates, function(i, v) {
                $candidateList.append($("<li></li>").append(v).append($('<button></button>').text('remove').bind('click', function() {
                    $.get('/removeCandidate', { 'candidate': v }, function(){});
                })));
            });
        } else if (obj.poorMan) {
            $('#poor-man').text(obj.poorMan);
        }

    };

    sockjs.onclose   = function()  {

    };

    var $candidate = $('#candidate form');
    $candidate.submit(function() {
        $.get('/addCandidate', {'candidate': $('input[name="candidate"]').val()}, function() {});
        return false;
    });

    $('#rand').bind('click', function() {
        $.get('/rand', {}, function(){});
    });

</script>
</body></html>